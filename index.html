<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <link rel="manifest" href="/pwa-app/manifest.json">
    <link rel="icon" href="favicon.png" type="image/png">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™‚é–“ç®¡ç†å››è±¡é™</title>
    <style>
        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1 {
            text-align: center;
            color: #333;
        }
        .controls {
            margin: 20px auto;
            max-width: 800px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .input-group {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            align-items: center;
            margin-bottom: 10px;
        }
        .grid-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            grid-template-rows: repeat(2, 1fr);
            gap: 15px;
            margin: 0 auto;
            max-width: 800px;
        }
        .quadrant {
            padding: 15px;
            background-color: white;
            border-radius: 8px;
            min-height: 200px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .quadrant h2 {
            margin-top: 0;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        #q1 {
            background-color: #ffebee; /* ç´…è‰²æ·ºèƒŒæ™¯ - ç·Šæ€¥ä¸”é‡è¦ */
        }
        #q2 {
            background-color: #e3f2fd; /* è—è‰²æ·ºèƒŒæ™¯ - é‡è¦ä½†ä¸ç·Šæ€¥ */
        }
        #q3 {
            background-color: #fff8e1; /* é»ƒè‰²æ·ºèƒŒæ™¯ - ç·Šæ€¥ä½†ä¸é‡è¦ */
        }
        #q4 {
            background-color: #f1f8e9; /* ç¶ è‰²æ·ºèƒŒæ™¯ - ä¸ç·Šæ€¥ä¸”ä¸é‡è¦ */
        }
        .task {
            margin: 10px 0;
            padding: 10px;
            background-color: rgba(255, 255, 255, 0.7);
            border-radius: 4px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
        }
        .task-info {
            flex: 1;
            min-width: 60%;
        }
        .task-title {
            font-weight: bold;
            margin-bottom: 3px;
        }
        .task-note {
            font-style: italic;
            font-size: 0.9em;
            color: #555;
        }
        .task-deadline {
            font-size: 0.85em;
            color: #555;
        }
        .urgent {
            color: #f44336;
            font-weight: bold;
        }
        .approaching {
            color: #ff9800;
        }
        .safe {
            color: #4CAF50;
        }
        .task-controls {
            display: flex;
            gap: 5px;
            align-items: center;
        }
        .task-controls button {
            border: none;
            background: none;
            cursor: pointer;
            font-size: 16px;
            padding: 3px;
        }
        .task-controls button:hover {
            background-color: rgba(0,0,0,0.05);
            border-radius: 3px;
        }
        input, select, button {
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        .delete-btn {
            color: #f44336;
            font-size: 14px;
        }
        .move-btn {
            color: #2196F3;
        }
        .completed {
            text-decoration: line-through;
            opacity: 0.6;
        }
        #sortSelect {
            margin-left: auto;
        }
        footer {
            text-align: center;
            margin-top: 20px;
            font-size: 0.85em;
            color: #666;
        }
        @media (max-width: 768px) {
            .grid-container {
                grid-template-columns: 1fr;
            }
            .input-group {
                flex-direction: column;
                align-items: stretch;
            }
            #sortSelect {
                margin-left: 0;
            }
        }
    </style>
</head>
<body>
    <h1>æ™‚é–“ç®¡ç†å››è±¡é™</h1>
    
    <div class="controls">
        <div class="input-group">
            <input type="text" id="taskInput" placeholder="è¼¸å…¥ä»»å‹™åç¨±..." style="flex: 2;">
            <input type="text" id="noteInput" placeholder="è¼¸å…¥å‚™è¨»..." style="flex: 2;">
            <input type="datetime-local" id="deadlineInput" style="flex: 1;">
            <select id="quadrantSelect">
                <option value="q1">é‡è¦ä¸”ç·Šæ€¥</option>
                <option value="q2">é‡è¦ä½†ä¸ç·Šæ€¥</option>
                <option value="q3">ç·Šæ€¥ä½†ä¸é‡è¦</option>
                <option value="q4">ä¸é‡è¦ä¹Ÿä¸ç·Šæ€¥</option>
            </select>
            <button onclick="addTask()">æ–°å¢ä»»å‹™</button>
        </div>
        <div class="input-group">
            <select id="sortSelect" onchange="loadTasks()">
                <option value="quadrant">ä¾è±¡é™æ’åº</option>
                <option value="deadline">ä¾æˆªæ­¢æ—¥æœŸæ’åº</option>
                <option value="created">ä¾å»ºç«‹æ—¥æœŸæ’åº</option>
            </select>
            <button onclick="loadTasks()">é‡æ–°æ•´ç†</button>
        </div>
    </div>
    
    <div class="grid-container">
        <div class="quadrant" id="q1">
            <h2>é‡è¦ä¸”ç·Šæ€¥</h2>
            <p>éœ€ç«‹å³è™•ç†çš„å±æ©Ÿ</p>
            <div class="tasks"></div>
        </div>
        <div class="quadrant" id="q2">
            <h2>é‡è¦ä½†ä¸ç·Šæ€¥</h2>
            <p>å°ˆæ³¨æŠ•è³‡çš„é …ç›®</p>
            <div class="tasks"></div>
        </div>
        <div class="quadrant" id="q3">
            <h2>ç·Šæ€¥ä½†ä¸é‡è¦</h2>
            <p>å¯å§”æ´¾çš„å¹²æ“¾</p>
            <div class="tasks"></div>
        </div>
        <div class="quadrant" id="q4">
            <h2>ä¸é‡è¦ä¹Ÿä¸ç·Šæ€¥</h2>
            <p>å¯ä»¥æ¶ˆé™¤çš„äº‹é …</p>
            <div class="tasks"></div>
        </div>
    </div>
    
    <footer>
        è³‡æ–™å„²å­˜æ–¼ç€è¦½å™¨çš„localStorageä¸­ï¼Œé—œé–‰é é¢å¾Œè³‡æ–™å°‡è‡ªå‹•ä¿ç•™ï¼Œå†æ¬¡é–‹å•Ÿå³å¯ç¹¼çºŒä½¿ç”¨ã€‚
    </footer>

    <script>
        if ('serviceWorker' in navigator) {
        window.addEventListener('load', function () {
            navigator.serviceWorker.register('/pwa-app/service-worker.js')
                .then(function (registration) {
                    console.log('Service Worker è¨»å†ŠæˆåŠŸ:', registration.scope);
                }, function (err) {
                    console.log('Service Worker è¨»å†Šå¤±æ•—:', err);
                });
        });
    }
        // å¾æœ¬åœ°å„²å­˜è¼‰å…¥ä»»å‹™
        document.addEventListener('DOMContentLoaded', function() {
            // è¨­å®šæˆªæ­¢æ—¥æœŸè¼¸å…¥æ¡†çš„é è¨­å€¼ç‚ºæ˜å¤©
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            document.getElementById('deadlineInput').valueAsDate = tomorrow;
            
            loadTasks();
        });

        // æ–°å¢ä»»å‹™
        function addTask() {
            const taskInput = document.getElementById('taskInput');
            const noteInput = document.getElementById('noteInput');
            const deadlineInput = document.getElementById('deadlineInput');
            const quadrantSelect = document.getElementById('quadrantSelect');
            
            if (taskInput.value.trim() === '') return;
            
            const taskText = taskInput.value;
            const noteText = noteInput.value;
            const deadline = deadlineInput.value ? new Date(deadlineInput.value).getTime() : null;
            const quadrantId = quadrantSelect.value;
            
            const task = {
                id: Date.now(),
                text: taskText,
                note: noteText,
                deadline: deadline,
                completed: false,
                quadrant: quadrantId,
                created: Date.now()
            };
            
            // ç²å–ç›®å‰ä»»å‹™åˆ—è¡¨
            let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
            tasks.push(task);
            
            // å„²å­˜åˆ°æœ¬åœ°å„²å­˜
            localStorage.setItem('tasks', JSON.stringify(tasks));
            
            // é‡æ–°è¼‰å…¥ä»»å‹™
            loadTasks();
            
            // æ¸…ç©ºè¼¸å…¥æ¬„ä½
            taskInput.value = '';
            noteInput.value = '';
        }

        // è¼‰å…¥ä»»å‹™
        function loadTasks() {
            let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
            const sortType = document.getElementById('sortSelect').value;
            
            // ä¾ç…§é¸æ“‡çš„æ–¹å¼æ’åº
            if (sortType === 'deadline') {
                tasks.sort((a, b) => {
                    if (!a.deadline) return 1;
                    if (!b.deadline) return -1;
                    return a.deadline - b.deadline;
                });
            } else if (sortType === 'created') {
                tasks.sort((a, b) => a.created - b.created);
            }
            
            // æ¸…ç©ºæ‰€æœ‰è±¡é™
            document.querySelectorAll('.tasks').forEach(el => {
                el.innerHTML = '';
            });
            
            // åˆ†é…ä»»å‹™åˆ°ç›¸æ‡‰è±¡é™
            tasks.forEach(task => {
                const quadrantTasks = document.querySelector(`#${task.quadrant} .tasks`);
                const taskElement = createTaskElement(task);
                quadrantTasks.appendChild(taskElement);
            });
        }

// å‰µå»ºä»»å‹™å…ƒç´ ï¼ˆæ›´æ–°ç‰ˆï¼‰
function createTaskElement(task) {
    const taskDiv = document.createElement('div');
    taskDiv.className = 'task';
    taskDiv.style.position = 'relative'; // è®“çµ•å°å®šä½å…ƒç´ ä»¥æ­¤å®¹å™¨ç‚ºåƒè€ƒ
    if (task.completed) {
        taskDiv.classList.add('completed');
    }
    taskDiv.setAttribute('data-id', task.id);

    // æˆªæ­¢æ—¥æœŸé¡¯ç¤ºï¼šä½æ–¼å³ä¸Šè§’ï¼Œåƒ…é¡¯ç¤ºæ ¼å¼åŒ–å¾Œçš„æ—¥æœŸ
    if (task.deadline) {
        const deadlineDate = new Date(task.deadline);
        const formattedDate = formatDate(deadlineDate); // å¯æ ¹æ“šéœ€è¦åªå–æ—¥æœŸéƒ¨åˆ†
        const deadlineSpan = document.createElement('span');
        deadlineSpan.className = 'task-deadline';
        deadlineSpan.style.position = 'absolute';
        deadlineSpan.style.top = '5px';
        deadlineSpan.style.right = '10px';
        deadlineSpan.style.fontSize = '0.8em';
        deadlineSpan.style.color = '#555';
        deadlineSpan.innerText = formattedDate;
        taskDiv.appendChild(deadlineSpan);
    }

    // ä»»å‹™è³‡è¨Šå€åŸŸï¼ˆæ¨™é¡Œèˆ‡å‚™è¨»ï¼‰
    const taskInfo = document.createElement('div');
    taskInfo.className = 'task-info';

    // ä»»å‹™æ¨™é¡Œï¼šé¡¯ç¤ºåœ¨ç¬¬ä¸€è¡Œï¼Œè‹¥ç‚ºé‡è¦ä¸”ç·Šæ€¥å‰‡æ¨™é¡Œç‚ºç´…è‰²
    const taskTitle = document.createElement('div');
    taskTitle.className = 'task-title';
    taskTitle.innerText = task.text;
    if (task.quadrant === 'q1') {
        taskTitle.style.color = 'red';
    }
    taskInfo.appendChild(taskTitle);

    // ä»»å‹™å‚™è¨»ï¼šé¡¯ç¤ºåœ¨æ¨™é¡Œä¸‹ï¼Œå­—é«”è¼ƒå°
    if (task.note && task.note.trim() !== '') {
        const taskNote = document.createElement('div');
        taskNote.className = 'task-note';
        taskNote.style.fontSize = '0.9em';
        taskNote.style.color = '#555';
        taskNote.innerText = task.note;
        taskInfo.appendChild(taskNote);
    }

    taskDiv.appendChild(taskInfo);

    // æ§åˆ¶æŒ‰éˆ•å€åŸŸï¼ˆå®Œæˆã€ä¿®æ”¹ã€ç§»å‹•ã€åˆªé™¤æŒ‰éˆ•ï¼‰
    const taskControls = document.createElement('div');
    taskControls.className = 'task-controls';

    // å®ŒæˆæŒ‰éˆ•
    const completeBtn = document.createElement('button');
    completeBtn.innerHTML = 'âœ“';
    completeBtn.title = task.completed ? 'æ¨™è¨˜ç‚ºæœªå®Œæˆ' : 'æ¨™è¨˜ç‚ºå®Œæˆ';
    completeBtn.onclick = function() {
        toggleComplete(task.id);
    };

    // ä¿®æ”¹æŒ‰éˆ•
    const editBtn = document.createElement('button');
    editBtn.innerHTML = 'âœ';
    editBtn.className = 'edit-btn';
    editBtn.title = 'ä¿®æ”¹ä»»å‹™';
    editBtn.onclick = function() {
        editTask(task.id);
    };

    // ç§»å‹•æŒ‰éˆ•
    const moveBtn = document.createElement('button');
    moveBtn.innerHTML = 'â†”ï¸';
    moveBtn.className = 'move-btn';
    moveBtn.title = 'ç§»å‹•åˆ°å¦ä¸€è±¡é™';
    moveBtn.onclick = function() {
        showMoveOptions(task.id);
    };

    // åˆªé™¤æŒ‰éˆ•
    const deleteBtn = document.createElement('button');
    deleteBtn.innerHTML = 'ğŸ—‘ï¸';
    deleteBtn.className = 'delete-btn';
    deleteBtn.title = 'åˆªé™¤ä»»å‹™';
    deleteBtn.onclick = function() {
        deleteTask(task.id);
    };

    taskControls.appendChild(completeBtn);
    taskControls.appendChild(editBtn);
    taskControls.appendChild(moveBtn);
    taskControls.appendChild(deleteBtn);
    taskDiv.appendChild(taskControls);

    return taskDiv;
}

        // æ ¼å¼åŒ–æ—¥æœŸé¡¯ç¤º
        function formatDate(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            
            return `${year}/${month}/${day} ${hours}:${minutes}`;
        }

        // åˆ‡æ›ä»»å‹™å®Œæˆç‹€æ…‹
        function toggleComplete(taskId) {
            let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
            
            tasks = tasks.map(task => {
                if (task.id === taskId) {
                    return {...task, completed: !task.completed};
                }
                return task;
            });
            
            localStorage.setItem('tasks', JSON.stringify(tasks));
            loadTasks();
        }

        // ä¿®æ”¹ä»»å‹™ï¼ˆåŒ…å«å‚™è¨»ï¼‰
        function editTask(taskId) {
            let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
            const task = tasks.find(t => t.id === taskId);
            
            if (!task) return;
            
            const newText = prompt('ä¿®æ”¹ä»»å‹™åç¨±:', task.text);
            if (newText === null) return; // ä½¿ç”¨è€…å–æ¶ˆ

            // ç·¨è¼¯å‚™è¨»æ¬„ä½
            const newNote = prompt('ä¿®æ”¹å‚™è¨»:', task.note || '');
            
            let newDeadline = null;
            if (task.deadline) {
                const deadlineDate = new Date(task.deadline);
                const year = deadlineDate.getFullYear();
                const month = String(deadlineDate.getMonth() + 1).padStart(2, '0');
                const day = String(deadlineDate.getDate()).padStart(2, '0');
                const hours = String(deadlineDate.getHours()).padStart(2, '0');
                const minutes = String(deadlineDate.getMinutes()).padStart(2, '0');
                
                const newDeadlineStr = prompt(
                    'ä¿®æ”¹æˆªæ­¢æ—¥æœŸ (YYYY/MM/DD HH:MM):',
                    `${year}/${month}/${day} ${hours}:${minutes}`
                );
                
                if (newDeadlineStr && newDeadlineStr.trim() !== '') {
                    newDeadline = new Date(newDeadlineStr.replace(/\//g, '-')).getTime();
                }
            } else {
                const addDeadline = confirm('æ˜¯å¦è¦åŠ å…¥æˆªæ­¢æ—¥æœŸï¼Ÿ');
                if (addDeadline) {
                    const now = new Date();
                    const year = now.getFullYear();
                    const month = String(now.getMonth() + 1).padStart(2, '0');
                    const day = String(now.getDate()).padStart(2, '0');
                    
                    const newDeadlineStr = prompt(
                        'è¼¸å…¥æˆªæ­¢æ—¥æœŸ (YYYY/MM/DD HH:MM):',
                        `${year}/${month}/${day} 23:59`
                    );
                    
                    if (newDeadlineStr && newDeadlineStr.trim() !== '') {
                        newDeadline = new Date(newDeadlineStr.replace(/\//g, '-')).getTime();
                    }
                }
            }
            
            const updatedTasks = tasks.map(t => {
                if (t.id === taskId) {
                    return {
                        ...t,
                        text: newText.trim() !== '' ? newText : t.text,
                        deadline: newDeadline !== null ? newDeadline : t.deadline,
                        note: newNote !== null ? newNote : t.note
                    };
                }
                return t;
            });
            
            localStorage.setItem('tasks', JSON.stringify(updatedTasks));
            loadTasks();
        }

        // é¡¯ç¤ºç§»å‹•é¸é …
        function showMoveOptions(taskId) {
            const tasks = JSON.parse(localStorage.getItem('tasks')) || [];
            const task = tasks.find(t => t.id === taskId);
            
            if (!task) return;
            
            const newQuadrant = prompt(
                'é¸æ“‡ç›®æ¨™è±¡é™:\n' +
                '1: é‡è¦ä¸”ç·Šæ€¥\n' +
                '2: é‡è¦ä½†ä¸ç·Šæ€¥\n' +
                '3: ç·Šæ€¥ä½†ä¸é‡è¦\n' +
                '4: ä¸é‡è¦ä¹Ÿä¸ç·Šæ€¥\n' +
                'è«‹è¼¸å…¥æ•¸å­— (1-4):'
            );
            
            if (newQuadrant && ['1', '2', '3', '4'].includes(newQuadrant)) {
                moveTask(taskId, `q${newQuadrant}`);
            }
        }

        // ç§»å‹•ä»»å‹™åˆ°å¦ä¸€è±¡é™
        function moveTask(taskId, newQuadrant) {
            let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
            
            tasks = tasks.map(task => {
                if (task.id === taskId) {
                    return {...task, quadrant: newQuadrant};
                }
                return task;
            });
            
            localStorage.setItem('tasks', JSON.stringify(tasks));
            loadTasks();
        }

        // åˆªé™¤ä»»å‹™
        function deleteTask(taskId) {
            if (!confirm('ç¢ºå®šè¦åˆªé™¤æ­¤ä»»å‹™å—ï¼Ÿ')) return;
            
            let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
            tasks = tasks.filter(task => task.id !== taskId);
            
            localStorage.setItem('tasks', JSON.stringify(tasks));
            loadTasks();
        }
    </script>
</body>
</html>
